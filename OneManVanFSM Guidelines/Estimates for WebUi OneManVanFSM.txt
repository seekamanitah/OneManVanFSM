Estimates for WebUi OneManVanFSM

### Estimates Page - Exhaustive Description

**Routes**: `/estimates` (list view for browsing, searching, and managing all estimates); `/estimates/{id}` (detail view for a specific estimate, including review, approval, and quick actions); `/estimates/new` or `/estimates/{id}/edit` (create/edit view for building or modifying estimates). For contextual integration, embeddable as a component or modal in related pages like Customers (e.g., `/customers/{customerId}/estimates` to list only that customer's or company's estimates) or Jobs (e.g., `/jobs/{jobId}/estimates` for converting an approved estimate to a job). This ensures seamless workflow—e.g., while viewing a customer's detail with multi-sites and assets, create a new estimate without leaving, with data (e.g., site sq ft/zones, existing assets for repair suggestions) transferring automatically to prepopulate the form, reducing steps for the contractor preparing bids for emergencies or scheduled work.

**Purpose & Business Context**:
- The Estimates page is designed as the "bidding engine" of the app, enabling contractors to quickly assemble, customize, and approve detailed proposals that serve as the precursor to jobs—capturing everything from initial site assessments to material/labor/pricing breakdowns, with a focus on accuracy to win work without underbidding or overlooking costs. For a small HVAC contractor, it addresses the need for rapid, reliable quoting: E.g., for a multi-zone system repair at a landlord's rental property, pull in site details (sq ft/stories), suggest compatible assets/products (e.g., "14" Flex Duct" based on existing furnace), build a material list, calculate time-based or flat-rate pricing, and generate a professional PDF for customer approval—all while handling urgencies like "Emergency: Standard Replacement" from the pasted-text priority dropdown. Presentation emphasizes progression: List views provide oversight with status pipelines (e.g., "Draft ? Sent ? Approved"), while details offer a "bid workbook" with embedded material lists and financial previews for iterative refinements.
- HVAC-specific: Incorporates template elements like system type (spider/trunk with CFM/reductions), equipment specs (tonnage/SEER), and sections for sealing/insulation/permits/disposal—ensuring bids comply with codes (e.g., auto-flag fire dampers for multi-story sites). Generic foundation: Sections and calcs are modular for other trades without app rework—e.g., repurpose "Ductwork" for "Piping Layout" in plumbing (sizes/fittings with flow calcs) or "Wiring Diagram" in electrical (gauges/circuits with amp loads), using customizable fields to adjust while maintaining core bidding (materials/labor/totals). This supports complex bids: A customer's multiple estates (e.g., primary + vacation homes, each with unique zones/assets) or a company's territorial sites (e.g., bids filtered by contact, ensuring the right approver gets the PDF).
- Business value: Promotes user-friendly efficiency by automating data transfer—e.g., import a customer's site/assets to prepopulate sq ft/zones/system type, build a material list (sections flow in), calculate pricing (time-based materials/labor hours/rates or flat overrides), and convert approved estimate to job (carry over all details to scheduling/materials/invoice draft). Industry thinking: Contractors bid under pressure (e.g., emergency quotes); the page supports this with mobile quick-start (clean UI for site visit notes), prepopulated customizable dropdowns (e.g., "Priority: Emergency" editable in settings), and shared data (e.g., a bid for a landlord's multi-rentals batches per site with shared totals for bulk discounts). For territorial companies, estimates route approvals to the right contact (e.g., John Doe for East sites). Overall robustness: Connectivity ensures bids are grounded in reality—e.g., material lists validate against inventory/products, sites provide context for calcs, and approvals trigger job creation with no lost data, reducing revisions and supporting accurate profitability.

**Data Sources & Interconnections**:
- **Core Entity**: Estimates table (ID PK, CustomerID/CompanyID/SiteID/AssetID/MaterialListID polymorphic FKs for linking; Status enum: Draft/Sent/Approved/Rejected/Expired – customizable with rules like "Auto-Expire After X Days"; Priority/Urgency enum from pasted-text; ExpiryDate; SystemType enum with fields like Plenum/Main Size/CFMs; SqFt/Zones/Stories (numeric); Total/Subtotal/Markup/Tax/Contingency (computed); Notes/PDFExportHistory). One-to-Many with Revisions (version history for changes).
- **Sources**: Prepopulates from Customers/Companies/Sites (ownership/address/sq ft/zones – customizable territorial contacts), Assets (existing equipment for repair bids), Material Lists (embedded sections for items), Products/Inventory (suggestions/validation for list building), Settings (default markup/tax/contingency %/labor rates – customizable per trade/urgency).
- **Interconnections** (App-Wide Flow for Shared Bid Data):
  - **Customers/Companies/Sites**: Many-to-One (Estimate CustomerID/CompanyID/SiteID FK). Connectivity: Estimate create/search filters by customer/site (prepopulates sq ft/zones/stories/access notes); multi-site estimates (e.g., landlord rentals) batch sub-bids per site (shared material lists). App flow: Customer detail "New Estimate" embeds estimates form (data transfer to site/assets); company territorial: Auto-select contact for approval notifications (e.g., Jill Dane for West site bids).
  - **Assets**: Many-to-Many (via EstimateAssets junction or material lists). Connectivity: Assets from selected site/customer prepopulate suggestions (e.g., "Repair Existing 20x20 Return" adds to sections); bid approval transfers to job for asset updates (e.g., new install creates asset). App flow: Asset detail "Estimate Repair for This" opens estimates form with asset prepopulated (data transfer to system type/materials); multi-assets per estimate/site (e.g., zone-specific calcs group in sections).
  - **Material Lists/Products/Inventory**: One-to-One (Estimate MaterialListID FK). Connectivity: Embedded material builder in estimate (prepopulates sections from template or asset history); products/inventory validate list items (e.g., low "UL 181A Tape" warns during build). App flow: Estimate "Build Materials" opens embedded builder (data transfer back to estimate totals/pricing); approval carries list to job (deductions create assets).
  - **Jobs**: One-to-One (Job from approved EstimateID on conversion). Connectivity: Approval → "Convert to Job" transfers all (sites/assets/material lists/system type/pricing/notes – data flow: Bid totals to job estimate, sections to job materials). App flow: From job detail, "View Original Estimate" links back (compare variances); multi-site jobs inherit estimate batches.
  - **Invoices/Expenses/Payments**: Indirect via job conversion (invoice from job pulls estimate data). Connectivity: Estimate financials (markup/tax/contingency from pasted-text) preview as "Projected Invoice"; approval transfers to job invoice draft. App flow: Estimate detail "Preview Invoice" embeds simulation (data to lines/fees); payments on resulting invoice update estimate reports (e.g., "Conversion Rate: Bid to Paid").
  - **Employees/ServiceAgreements/QuickNotes**: Employees for labor est. in pricing (rates prepopulate time-based calcs); agreements suggest estimate templates (e.g., recurring tune-up bid). Connectivity: Quick note import to notes (e.g., "Site Assessment" category to system type); employee certs filter bid suggestions (e.g., "EPA for Refrigerant"). App flow: From agreement detail, "New Estimate for Next Visit" prepopulates from previous.
  - **Shared Data Flow**: Customer/site select (transfer sq ft/zones/access) → Asset/product suggest (prepopulate material sections/specs) → Build list (transfer to estimate totals/pricing) → Calculate (time/flat with labor/markup/contingency) → Approval/convert to job (carry all to scheduling/materials) → Execution/completion (update assets/inventory) → Invoice generation (transfer financials/fees). For multi-site: "Batch Estimate" duplicates for landlord estates (shared data like totals aggregate for discounts). Robust views: "EstimateConversionView" (joins jobs/invoices for bid success rates); "TerritorialBidView" (filters by company contact).

**Layout & Sections** (Desktop Web Focus: Workbook-Style Builder with Previews, Responsive for Mobile Accordion-Stacking):
- **List View (/estimates)**: Pipeline board or table (columns/status lanes: Draft/Sent/Approved/Rejected – draggable to update; fields: Estimate #/Customer/Company/Site (clickable), Priority Badge, Expiry Date/Total, Conversion Status (to Job) – sortable/prepopulated filters like "Emergency" dropdown customizable). Groupable by customer/company for multi-bid overviews. Responsive: Cards with status swipes.
- **Detail View (/estimates/{id})**: Bid "proposal" with tabs/accordions.
  - **Header**: Estimate #/Status (dropdown to update – customizable rules), Priority/Urgency Badge, Quick Actions dropdown ("Approve & Convert to Job/Edit/Send PDF/Reject" – prepopulates job form with estimate data).
  - **Core Info Section**: Linked Customer/Company/Contact (territorial dropdown if company), Site/Link (sq ft/zones/stories – prepopulated from site), System Type (dropdown with fields like CFM – customizable), Notes (quick note import).
  - **Material List Accordion**: Embedded builder/view (sections from pasted-text, with totals).
  - **Pricing & Financials Accordion**: Method Toggle (Time/Flat – refreshes calcs), Labor Inputs (hours/rate/contingency), Totals (subtotal/markup/tax/grand).
  - **Connections Accordion**: "Linked Site/Assets" (embedded summaries with multi-asset grouping); "Projected Job/Invoice" (preview links).
  - **Revisions & History Accordion**: Version table (changes/dates/users).
  - **Footer**: "Generate PDF" (full/supplier no-price – customizable templates), related links (e.g., "View for Owner" filtered by customer).
- **Edit/Create View**: Form with integrations (e.g., "Import from Template/List" dropdown prepopulates – customizable).

**UX Interactions & Flows**:
- **Bidding Flow**: Create from customer/site (prepopulate all) → Embed material builder (add sections) → Toggle pricing (time/flat refreshes totals) → Preview PDF (full/no-price) → Send/Approve (convert to job with transfer).
- **Connectivity Flow**: From detail, "Convert to Job" → Opens job form with data transfer (sites/assets/lists/pricing); rejection logs reason (appends to history).
- **List to Detail**: Filter "Approved for Territorial Contacts" → Click estimate → Detail with financials expanded; for multi-site companies, filter groups by site.
- **User Journey**: Office from customer (company with chain stores) → New estimate batch for multi-sites (prepopulate shared lists/assets) → Approve (transfer to job, notify territorial contact) → Tech mobile views estimate detail in job (for reference) → Close (transfer to invoice).
- **Efficiency Features**: Prepopulated dropdowns (status/priority/system type – customizable add/edit/remove); auto-calcs (e.g., zones influence material suggestions); search integrates estimate # across app.

**Customizations & Configurability**:
- Admins: Add/edit/remove enums (e.g., Status: Add "Pending Review"; Type: Add "Plumbing Quote"); customize calc rules (e.g., default time/flat per urgency); toggle fields (e.g., add "Environmental Factors" for HVAC). Per-role: Techs view bids only (for job reference); office approves/full edit.
- Quick Notes: Import to notes (e.g., "Bid Adjustment" category auto-appends as revision).

**Edge Cases & Robustness**:
- Multi-Site Bids: Handle "One Estimate, Multiple Sites" (e.g., batch sections with shared totals – grouped views); "Territorial Approval" (contact-specific workflows/notifications).
- No Data: Prompt "Import from Template/Customer?" on create.
- Large Estimates: Pagination in sections/history; collapse accordions.
- Permissions: Techs view linked estimates (status only); approvers change status. Hidden pricing for non-bidders.
- Offline: Mobile caches draft estimates (build local, sync with conflict resolution – e.g., "Duplicate Approval – Merge?").

**Integrations & Automation**:
- Triggers: Expiry near → Alert (e.g., "Approve Before Date?"); approval → Auto-job draft/notify customer/contact/tech.
- External: PDF generation (full/no-price for send); email for bid delivery (to territorial contact); Calendar for projected scheduling preview.
- Workflow Ties: Quick links ensure progression (e.g., "From Estimate to Job" → Prepopulates scheduler with sites/assets/lists, transferring data). For companies: Territorial auto-routing (e.g., approve button notifies right contact for site bids).

**Mobile Considerations**:
- List as priority-filtered cards (swipe to approve/convert); detail as vertical scroll with accordions (tap expand materials). Mobile bid review: Clean preview UI with voice notes, scan for material adds. Offline cache prioritizes tech's assigned estimates (approve local, sync converts to job). Responsive layouts stack pipelines to lists; embedded forms as bottom sheets for customer/context building, ensuring techs can review/approve on-site without rework. 