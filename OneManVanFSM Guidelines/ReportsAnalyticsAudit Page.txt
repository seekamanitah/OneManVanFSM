Reports/Analytics/Audit Page 

**Routes**: `/reports` (main dashboard view for an integrated overview of reports, analytics, and audits, with tabs or sections for navigation); sub-routes for focused areas like `/reports/analytics` (analytics dashboards and KPIs), `/reports/standard` (prebuilt report templates and exports), `/reports/custom` (custom report builder), and `/reports/audit` (audit logs viewer). For contextual integration, embeddable as a component or modal in related pages like Financials (e.g., `/financials/reports` to run A/R aging directly from invoices) or Jobs (e.g., `/jobs/{jobId}/reports` to generate a job profitability summary). This ensures seamless workflow—e.g., while reviewing an overdue invoice in Financials for a territorial company site, open an embedded audit log without leaving, with data (e.g., payment history from the invoice) transferring automatically to filter the logs, reducing steps for the contractor investigating discrepancies or analyzing performance trends across multi-site landlords or company divisions.

**Purpose & Business Context**:
- The Reports/Analytics/Audit page is designed as the app's "insights engine," a unified hub that aggregates data from every module to provide actionable reports (structured outputs like profitability breakdowns), analytics (visual KPIs and trends for decision-making), and audits (detailed logs for compliance and troubleshooting)—serving as the tool that turns raw operational data into business intelligence. For a small HVAC contractor, it addresses the need for visibility: E.g., run a "Job Profitability Report" to see margins on a multi-zone install at a landlord's rental property (breaking down materials from lists, labor from employee time, and variances from inventory deductions), analyze "Asset Repair Trends" across a company's territorial sites (flagging frequent non-warranty refrigerant issues for upsell to agreements), or audit "Who Voided This Invoice?" for a disputed payment. Presentation emphasizes accessibility: Dashboard views show customizable KPI cards (e.g., "A/R Overdue: $5K by Territory"), while sub-sections offer drill-downs with exports, ensuring quick answers without complex queries.
- HVAC-specific: Defaults focus on metrics like "SEER Efficiency Trends" from assets or "Refrigerant Usage by Claim Type" from history/claims, with seasonal filters (e.g., "Summer Overload Repairs"). Generic foundation: Metrics and reports are modular for other trades without app rework—e.g., repurpose "Duct Leak Repairs" for "Pipe Burst Incidents" in plumbing (leak rates by site) or "Circuit Failures" in electrical (overload counts by amp), using customizable filters to adjust while maintaining core analytics (profit by job/site/asset). This supports complex insights: A customer's multiple estates (e.g., aggregate "Repair Costs Across Rentals" to spot patterns) or a company's territorial divisions (e.g., "Performance by Contact: East vs. West KPIs").
- Business value: Promotes user-friendly efficiency by automating shared data aggregation—e.g., a "Tech Performance Report" pulls time from employee logs/jobs, costs from material lists/inventory, and outcomes from assets/history (no manual compilation), with data transferring to exports or notifications (e.g., "Low Margin Alert—Drill to Job?"). Industry thinking: Contractors need data for growth (e.g., "Which Sites Have High Non-Warranty Claims? Upsell Agreements"); the page supports this with mobile overviews for owners (clean, chart-focused UI for on-the-go checks), prepopulated customizable dropdowns (e.g., "Report Type: Profitability" editable in Settings to add "Plumbing Leak Rate"), and shared data (e.g., an audit for a company's chain invoice links to territorial contact for resolution, with site-specific filters like "East County Only"). For small operations, it reduces guesswork: Auto-generated standard reports (templates from Settings) tie to financials for cash flow, while custom builder allows "Ad-Hoc Query: Repairs by Asset Type Across Landlords." Overall robustness: As an integrated page, it ensures traceability—e.g., reports from jobs/financials/assets feed analytics for trends, audits log all changes (from Settings edits to job status updates), building compliance and informed decisions.

**Data Sources & Interconnections**:
- **Core Entities**: Reports table (ID PK, Type enum: Standard/Custom – customizable; QueryParams JSON for filters; OutputFormat: Table/Chart/CSV/PDF); AnalyticsKPI table (ID PK, MetricName, Value/Formula – e.g., "A/R Overdue" computed from Invoices); AuditLogs table (ID PK, ActionType, EntityType/ID, UserID FK, Timestamp, Changes JSON – for all app events). One-to-Many with ReportTemplates (prebuilt queries – customizable).
- **Sources**: Aggregates from all modules (Jobs/Financials/Assets/Inventory/Employees/Service Agreements/History/Claims/Documents – customizable metrics in Settings); AuditLogs auto-populate from app actions (e.g., every FK update/change).
- **Interconnections** (App-Wide Flow for Shared Insights Data):
  - **Jobs/Estimates/Calendar/Service Agreements**: Primary for operational reports (e.g., "Job Profitability" joins jobs/material lists/time entries/invoices for margins by site/territory). Connectivity: Job completion logs to audits (data flow to "Variance Report"); agreements visits aggregate to "Renewal Analytics" (trends by customer/site). App flow: From job detail, embedded "Run Report" pulls job-specific KPIs (transfer to full page for export).
  - **Sites/Customers/Companies/Assets**: Key for client/equipment analytics (e.g., "Repair Trends by Site" joins sites/assets/history/jobs – filters by territorial contact). Connectivity: Customer summaries embed mini-reports (data transfer to full page); multi-site (landlords) aggregate "Costs Across Estates." App flow: Customer detail "Analytics" tab links here filtered (e.g., "A/R by Site").
  - **Material Lists/Inventory/Products**: For cost/inventory reports (e.g., "Material Variance Analytics" joins lists/jobs/inventory for overages by product/site). Connectivity: Low stock from inventory logs to audits; product usage trends feed "Reorder Recommendations." App flow: Inventory detail "Run Usage Report" transfers to here.
  - **Financials (Invoices/Expenses/Payments)**: Core for monetary analytics (e.g., "A/R Aging" from invoices/payments – by customer/site/company). Connectivity: Payment record logs to audits; expenses from variances tie to "Profit by Job" reports. App flow: Financials dashboard embeds analytics cards (transfer to full page for custom filters).
  - **Employees/QuickNotes/Documents/History & Claims**: For HR/performance audits (e.g., "Tech Efficiency Analytics" joins employees/time entries/jobs/history – by cert/territory). Connectivity: Quick note imports log to audits; document access/updates track in logs. App flow: Employee detail "Performance Report" embeds here filtered (e.g., "Repairs Completed by Tech").
  - **Shared Data Flow**: App action (e.g., job status update) → Auto-log to audits (prepopulate entity/type/changes) → Aggregate to reports/analytics (transfer for KPIs like "Job Completion Rate by Tech/Territory") → Export/customize in page (data to CSV/PDF with filters). For multi-site: "Batch Report" aggregates (shared data like costs by landlord estate). Robust views: "GlobalAuditView" (joins all logs); "ProfitAnalyticsView" (computed from jobs/financials/assets).

**Layout & Sections** (Desktop Web Focus: Dashboard-Style with Charts, Responsive for Mobile Card-Stacking):
- **Main Dashboard View (/reports)**: Tabbed interface (Reports/Analytics/Audits – with shared search/filter bar at top for entity/date/range/role/territory – prepopulated dropdowns customizable).
  - **Reports Tab**: Prebuilt templates list (e.g., "Job Profitability," "A/R Aging," "Asset Trends" – run with filters; results as table/chart/export – customizable add/edit in Settings).
  - **Analytics Tab**: KPI cards (e.g., "Revenue YTD: $50K by Territory," "Tech Utilization: 85% – Chart by Cert") – draggable/customizable; drill-down charts (e.g., "Repair Patterns by Site/Asset" – filter by trade mode).
  - **Audits Tab**: Log table (columns: Timestamp/User/Action/Entity/Link/Changes – sortable/filterable by type/entity/role – e.g., "Job Updates Only").
  - **Custom Builder Section** (Accordion in Reports tab): Query wizard (select entities/metrics/filters – e.g., "Profit by Job: Filter by Site/Territory" – preview/run/save as template).
- **Detail View (/reports/{id} or /reports/audit/{logId})**: Focused result/log (e.g., report detail with export; audit log with diff viewer for changes).
- **Create/Edit View** (For Custom Reports): Form with entity selector (dropdown from app modules – customizable), metrics picker (prepopulated like "Total Cost" – add/edit), filters (date/range/site etc.).

**UX Interactions & Flows**:
- **Reporting Flow**: Select template (e.g., "A/R Aging") → Apply filters (prepopulate customizable dropdowns like "By Territory") → Run (preview table/chart) → Export (CSV/PDF – customizable format).
- **Connectivity Flow**: From detail, "Drill to Entity" → Navigates to linked page (e.g., from "Overdue Invoice KPI" to Financials detail – data transfer filter).
- **Main to Detail**: Filter "Analytics for Territorial Contacts" → Click KPI → Detail with chart expanded; for multi-site companies, filter groups by site.
- **User Journey**: Owner from Dashboard (overdue alert) → Reports tab → Run "A/R Aging by Site" (prepopulate from financials) → Drill to invoice (territorial filter) → Audit "Who Edited?" (from log table).
- **Efficiency Features**: Prepopulated dropdowns (metrics/filters – customizable add/edit/remove); auto-suggest (e.g., "Similar to Last Run"); search logs/reports by keyword.

**Customizations & Configurability**:
- Admins: Add/edit/remove report templates/metrics (e.g., add "Plumbing Leak Rate"); customize KPI cards (drag/reorder/add – e.g., "By Trade Mode"); toggle audit depth (e.g., log all or major changes only). Per-role: Techs view performance analytics only (their KPIs); owners full reports/audits.
- Quick Notes: Not directly, but reports can include note summaries (e.g., "Job Notes Trends").

**Edge Cases & Robustness**:
- Multi-Site Analytics: Handle "Aggregate by Territory" (e.g., batch reports for landlord estates – grouped KPIs); "Company Routing" (territorial filters/edits in audits).
- No Data: Empty state actionable (e.g., "No Logs—Start a Job?").
- Large Datasets: Pagination in tables/logs; async loading for charts.
- Permissions: Techs view own audits/performance (no full reports); managers run operational reports. Hidden sensitive logs for techs.
- Offline: Mobile caches recent reports/analytics (view local, sync runs on connect – warn stale data).

**Integrations & Automation**:
- Triggers: Report run → Alert (e.g., "Low Profit Detected—Notify Owner?"); audit anomaly (e.g., frequent voids) → Notification.
- External: Export to QuickBooks/Excel (CSV/PDF from reports); Google Analytics for app usage (optional in Settings).
- Workflow Ties: Quick links ensure progression (e.g., "From Report to Job" → Navigates to filtered jobs page, transferring data). For companies: Territorial auto-filter (e.g., show East analytics for John Doe).

**Mobile Considerations**:
- Dashboard tabs as swipeable; reports as filterable cards (swipe to export/view chart). Mobile analytics: Clean KPI cards with tap-drill (e.g., "My Performance" for techs). Offline cache prioritizes personal reports/audits (view local, sync runs on connect). Responsive layouts stack tabs to sections; embedded in financials/jobs as bottom sheet for quick runs, ensuring owners check insights on-the-go without rework.