Templates page for OneManVanFSM

### Templates Page - Exhaustive Description

**Routes**: `/templates` (main list/dashboard view for browsing, searching, and managing all template types across the app); `/templates/{id}` (detail view for a specific template, including previews, usage history, and quick actions); `/templates/new` or `/templates/{id}/edit` (create/edit view for building or modifying templates); `/templates/{type}` (filtered views by type, e.g., `/templates/materiallists` for material list templates). For contextual integration, embeddable as a component or modal in related pages like Material Lists Builder (e.g., `/materiallists/{listId}/templates` to load and apply a template without leaving the builder) or Products (e.g., `/products/{productId}/templates` to create a variant template from a product). This ensures seamless workflow—e.g., while creating a new material list in an estimate for a multi-site landlord's rentals, open an embedded template selector without leaving, with data (e.g., common "Standard AC Install Kit" sections from company defaults) transferring automatically to prepopulate the list, reducing repetitive entry for the contractor quoting similar jobs across estates or territorial company sites.

**Purpose & Business Context**:
- The Templates page is envisioned as the app's "reusable blueprint library," a dedicated hub for creating, storing, and applying standardized patterns for common elements like material lists, job checklists, estimate formats, product variants, or service agreement structures—serving as the efficiency accelerator that lets contractors avoid starting from scratch every time. For a small HVAC contractor, it captures the repetitive nature of work: E.g., a "Standard Trunk System Install" template prepopulates material list sections (flex duct sizes/counts/boxes, take offs, sealing tape rolls) with defaults like CFM reductions and labor estimates, which can be cloned for a company's territorial site bid or a landlord's multi-rental properties (customized per site's sq ft/zones but sharing core items for bulk efficiency). Presentation emphasizes reusability: List views show usage metrics (e.g., "This template used in 10 jobs this month—average variance 5%"), while details provide a "template editor" with previews and quick apply buttons for instant workflow insertion.
- HVAC-specific: Defaults focus on common setups like "Spider Plenum Kit" (with pasted-text sections for ductboard/metal, insulation sq ft), including HVAC-unique fields (e.g., SEER/tonnage in equipment templates, refrigerant qty in material lists). Generic foundation: Templates are type-based and modular for other trades without app rework—e.g., repurpose a material list template for "Plumbing Pipe Install Kit" (sizes/fittings/counts with flow calcs) or "Electrical Wiring Bundle" (gauges/lengths/boxes with amp loads), using customizable sections to adjust while maintaining core reusability (e.g., labor estimates switch from "HVAC Hours" to "Plumbing Labor" via Settings). This supports complex scenarios: A customer's multiple estates (e.g., template forked per property with shared defaults for efficiency) or a company's territorial divisions (e.g., "East County Standard Kit" filtered by contact, ensuring consistent bidding across sites).
- Business value: Promotes user-friendly efficiency by automating shared data transfer—e.g., apply a "Quarterly Tune-Up" job template (prepopulated checklist/material list from service agreements) to auto-schedule recurring visits for a multi-site customer, with sections flowing to the job's materials (no re-building lists each time). Industry thinking: Contractors rely on standards to speed operations (e.g., a tech at a remote site clones a template for quick material additions without office input); the page supports this with mobile apply (clean UI for on-job customization), prepopulated customizable sections (e.g., "Ductwork: Flex Duct Sizes" editable in Settings to add "Copper Pipe Diameters" for plumbing), and shared data (e.g., a template for a company's chain links to territorial contacts for approval, with site-specific overrides like "Extra Insulation for High-Humidity Store"). For small operations, it reduces errors: Templates validate against inventory/products (e.g., low-stock warning on apply), and usage metrics tie to reports for refinement (e.g., "This template has high variances—update defaults?"). Overall robustness: As a separate page from Settings (as requested), it focuses on company-level operational defaults without cluttering global configs, with connectivity ensuring templates propagate (e.g., apply to estimates/jobs/agreements, updating assets/inventory/financials on use).

**Data Sources & Interconnections**:
- **Core Entity**: Templates table (ID PK, Type enum: MaterialList/JobChecklist/EstimateFormat/ProductVariant/ServiceAgreementStructure/Other – customizable; Name/Description; Data JSON (structured content, e.g., for material list: Sections with items/quantities/defaults); IsCompanyDefault flag for sharing; UsageCount/LastUsed for metrics; Notes). One-to-Many with TemplateVersions (history for edits).
- **Sources**: Prepopulates from Products (for variant templates – customizable specs like sizes/units), Material Lists (sections as base for kits), Jobs (checklists from past), Settings (trade mode adapts defaults – e.g., HVAC: "Ductwork Sections"; Plumbing: "Pipe Fitting Kits").
- **Interconnections** (App-Wide Flow for Shared Reusable Data):
  - **Material Lists/Estimates/Jobs**: One-to-Many (List/Estimate/Job TemplateID FK for apply). Connectivity: Template "Apply to List" transfers sections/items (e.g., flex duct counts/boxes to builder – data flow: Defaults to quantities/pricing); job apply prepopulates checklist/materials (transfer to execution). App flow: From material builder, "Load Template" pulls from here (data transfer back on save as new variant); multi-site jobs (e.g., landlord rentals) batch apply templates with site-specific overrides.
  - **Assets/Products/Inventory**: N:1 (Template from ProductID for variants); indirect via material lists/jobs. Connectivity: Product variant template creates asset defaults (transfer specs on install); inventory checks template items on apply (e.g., warn low "UL 181A Tape"). App flow: Asset create "From Product Template" pulls variants (data transfer to asset fields); inventory "Suggest Template Stock" links to here.
  - **Customers/Companies/Sites/Service Agreements/History & Claims**: Polymorphic FKs for template ownership/context (e.g., company-specific "Territorial Kit"). Connectivity: Template apply to agreement prepopulates recurring sections (transfer to scheduled jobs/visits); history/claims reference template items (e.g., "Used Standard Kit in Repair"). App flow: Customer detail "Apply Template for New Agreement" embeds selector (data transfer to sites/assets); territorial companies: Filter templates by contact (e.g., East for John Doe).
  - **Financials (Invoices/Expenses/Payments)/Employees/QuickNotes**: Indirect via jobs/estimates (template pricing/labor transfers to calcs). Connectivity: Employee rates in job templates (time-based defaults); quick notes import to template notes (e.g., "Variant Tip" category). App flow: Invoice from job embeds template preview (data to lines); expenses from template variances (transfer to reimbursements).
  - **Shared Data Flow**: Create template (prepopulate from products/inventory/settings) → Apply to estimate/material list (transfer sections/defaults to bid) → Carry to job/agreement (transfer to scheduling/visits/checklists) → Execution/update (transfer to history/claims/assets/inventory deductions) → Financial close (transfer to invoice/expenses/payroll). For multi-site: "Batch Apply" duplicates with shared defaults. Robust views: "TemplateUsageView" (joins usage metrics for refinement); "TerritorialTemplateView" (filters by company contact).

**Layout & Sections** (Desktop Web Focus: Library-Style with Previews, Responsive for Mobile Card-Stacking):
- **List View (/templates)**: Searchable table (columns: Name/Type (dropdown filter – customizable), Description/Preview Snippet (e.g., "Ductwork: 5 Sizes"), Usage Count/Last Used, IsCompanyDefault Badge – sortable/prepopulated like "MaterialList Only" dropdown). Groupable by type for quick access. Responsive: Cards with preview icons.
- **Detail View (/templates/{id})**: Template "blueprint" with sections.
  - **Header**: Name/Type, IsCompanyDefault Toggle, Quick Actions dropdown ("Edit/Clone/Apply to Estimate/Job/Agreement/Delete" – prepopulates target forms with template data; "Export CSV" for offline edit/import).
  - **Core Content Section**: Editable structured form/JSON viewer (e.g., for material list: Accordions with sections/items/quantities/defaults – customizable).
  - **Variants & Versions Accordion**: Table of sub-templates (add/edit inline); History Table (changes/dates/users).
  - **Usage & Connections Accordion**: "Applied In" table (estimates/jobs/agreements/assets – clickable links; multi-site grouping for landlords/companies).
  - **Notes Accordion**: Text/Quick Notes feed (import for tips).
  - **Footer**: "Preview in Context" (e.g., simulate in Material Builder), related links (e.g., "View Similar by Type" filtered).
- **Edit/Create View**: Builder form mirroring detail, with type selector (dropdown customizable), content editor (drag-add sections/items – prepopulated from products/inventory).

**UX Interactions & Flows**:
- **Template Flow**: Create new (select type) → Build content (prepopulate customizable sections/items) → Save as default (share company-wide) → Apply to estimate (transfer to builder).
- **Connectivity Flow**: From detail, "Apply to Job" → Opens job form with template data (transfer to materials/checklist); clone "Fork for Site" for multi-site customizations.
- **List to Detail**: Filter "Company Defaults for Territorial" → Click template → Detail with usage expanded; for multi-site companies, filter groups by site.
- **User Journey**: Office create "Standard Tune-Up" template (prepopulate from products/materials) → Set as default → Tech applies to mobile job for landlord multi-rentals (transfer to checklist/materials) → Update on close (transfer to history/invoice).
- **Efficiency Features**: Prepopulated dropdowns (types/sections – customizable add/edit/remove); auto-preview (e.g., "See in Material List"); search templates by usage.

**Customizations & Configurability**:
- Admins: Add/edit/remove types (e.g., add "Plumbing Checklist"); customize content editors (e.g., add fields like "Flow Rate" for plumbing); toggle defaults (company-wide vs. user-specific). Per-role: Techs view/apply only (no create); office full edit.
- Quick Notes: Import to template notes (e.g., "Tip" category auto-appends as instruction).

**Edge Cases & Robustness**:
- Multi-Site Defaults: Handle "One Template, Multiple Variants" (e.g., territorial forks for companies – grouped applies); "Company Shared" (defaults visible by contact filter).
- No Usage: Suggest "Apply Now?" on detail.
- Large Libraries: Pagination in lists/variants; filter limits (e.g., "By Type Only").
- Permissions: Techs apply templates (from jobs); managers create/default. Hidden advanced for techs.
- Offline: Mobile caches frequently used templates (apply local, sync creates variants with merge).

**Integrations & Automation**:
- Triggers: Template apply → Alert (e.g., "Low Inventory for Template Items – Reorder?"); high usage → Suggest "Make Default?".
- External: CSV import/export (for bulk entry – e.g., supplier catalogs); API for template sharing (if multi-company).
- Workflow Ties: Quick links ensure progression (e.g., "From Template to New Estimate" → Prepopulates builder with sections, transferring data). For companies: Territorial auto-filter (e.g., show East defaults for John Doe).

**Mobile Considerations**:
- List as type-filtered cards (swipe to apply/preview); detail as vertical scroll with accordions (tap expand content). Mobile apply: Clean selector for job-context (prepopulate from current job). Offline cache prioritizes company defaults (apply local, sync updates usage). Responsive layouts stack groups to lists; embedded in material builder as bottom sheet for quick load, ensuring techs can use templates on-site without rework.