scheduling and calendar for WebUi OneManVanFSM

### Calendar/Scheduling Page - Exhaustive Description

**Routes**: `/calendar` (main calendar view for daily/weekly/monthly oversight and dispatching); `/calendar/{date}` (focused view for a specific date or range, e.g., `/calendar/2026-02-05` for daily details); `/calendar/jobs/{jobId}` (embedded or modal view for scheduling a specific job). For contextual integration, embeddable as a component or iframe-like panel in related pages like Jobs (e.g., `/jobs/{jobId}/calendar` to schedule/reschedule without leaving the job detail) or Customers (e.g., `/customers/{customerId}/calendar` to view/schedule all jobs for that customer/company across sites). This ensures seamless workflow—e.g., while viewing a job's detail, open the calendar inline to drag-drop a new time slot, with data (e.g., job's site/assets/required tech certs) transferring automatically to check conflicts and suggest optimal slots, reducing navigation for the contractor balancing emergencies and routine maintenance.

**Purpose & Business Context**:
- The Calendar/Scheduling page is designed as the visual "dispatch board" for orchestrating all time-based activities, serving as the app's temporal hub where jobs, maintenance, and resources align to maximize efficiency and minimize downtime. For a small HVAC contractor, it addresses the chaotic scheduling demands: E.g., drag an emergency AC repair (high priority from pasted-text urgency) onto a certified tech's slot, factoring in site location (geo-optimization for travel time), asset due dates (e.g., warranty tune-up for a furnace at a landlord's rental), and inventory availability (e.g., ensure "16" Flex Duct" boxes are in the tech's truck stock before confirming). Presentation emphasizes intuitiveness: A interactive grid/calendar with color-coded events (e.g., red for emergencies, green for scheduled), overlays for conflicts (e.g., "Tech Overbooked – Suggest Alternative?"), and quick filters for territorial views (e.g., East County jobs only).
- HVAC-specific: Incorporates factors like seasonal loads (e.g., prioritize heatwave emergencies with auto-alerts for available slots), system complexities (e.g., multi-zone jobs requiring longer durations based on sq ft/stories from sites), and compliance (e.g., flag slots needing EPA-certified techs for refrigerant handling). Generic foundation: Adaptable for other trades without app rework—e.g., repurpose "Zones" for "Circuit Loads" in electrical (schedule panel upgrades with amp checks) or "Fixture Counts" in plumbing (bathroom remodels with duration based on units), using customizable filters to adjust while maintaining core scheduling (tech assignment, conflict resolution). This supports complex setups: A customer's multiple estates (e.g., schedule sequential tune-ups across properties, batched for efficiency) or a company's territorial sites (e.g., filter calendar by contact, ensuring West sites align with Jill Dane's approvals).
- Business value: Promotes user-friendly efficiency by automating shared data transfer—e.g., pull a job from estimates (carry over priority/site/assets/material lists), suggest slots based on tech certs/location/inventory (no manual checks), and update the job upon scheduling (flow back to status/timeline/invoice est.). Industry thinking: Contractors juggle reactive work (e.g., emergencies bumping routines); the page supports this with drag-drop rescheduling, prepopulated customizable dropdowns (e.g., "Urgency: Emergency" editable in settings to add "Routine Check"), and mobile views for techs (clean, their-schedule-only UI). For multi-site customers/companies (e.g., landlords with rentals or chains with divisions), it enables "group scheduling" (batch similar jobs across sites, shared resources like tech trucks), with territorial filtering to assign correctly (e.g., notify right contact on slot changes). Overall robustness: Connectivity ensures no overbooking—e.g., a scheduled job validates material availability from lists/inventory, updates asset maintenance history, and logs changes for reports/payroll, reducing no-shows and supporting scalable operations.

**Data Sources & Interconnections**:
- **Core Entity**: CalendarEvents table (ID PK, JobID/AgreementID polymorphic FK for linking; Start/End DateTime, Duration (computed or manual), Status enum: Tentative/Confirmed/Completed/Cancelled – customizable; TechID/EmployeeID FK for assignment; Notes/Checklist JSON for sub-tasks). Integrates with Jobs table for core data (e.g., sync status on drag).
- **Sources**: Prepopulates from Jobs/Estimates (events from scheduled/approved), Employees (availability/cert calendars), Sites (geo/address for optimization), Assets (due maintenance triggers events), ServiceAgreements (recurring slots), Settings (default durations/business hours – customizable per trade/urgency).
- **Interconnections** (App-Wide Flow for Shared Temporal Data):
  - **Jobs/Estimates**: One-to-One/Many (Job CalendarEventID FK). Connectivity: Job approval/creation → Auto-suggest calendar slot (based on priority/tech certs/site location); drag reschedule updates job date (data flow: Transfer to status/timeline). App flow: From job detail, embedded calendar for rescheduling (changes sync back); multi-jobs (e.g., batch for landlord sites) group as linked events.
  - **Sites/Customers/Companies**: Many-to-One (Event SiteID/CustomerID/CompanyID FK). Connectivity: Site select in scheduling → Prepopulates travel time (geo-calc from tech location), access notes (transfer to event checklist). App flow: Customer detail "Schedule Job" embeds calendar filtered by their sites (data transfer to events); company territorial: Filter view by contact (e.g., West events for Jill Dane, auto-notify on changes); multi-sites (e.g., estates) suggest sequential slots with shared techs.
  - **Assets**: Many-to-Many (via EventAssets junction). Connectivity: Asset warranty/due date → Auto-create event suggestion (e.g., "Tune-Up Slot for Furnace at Site A"); scheduling validates asset needs (e.g., suggest materials from history). App flow: Asset detail "Schedule for This" opens calendar with asset prepopulated (data transfer to event type/checklist); multi-assets per event/site (e.g., zone repairs as sub-tasks).
  - **Material Lists/Inventory/Products**: Indirect via jobs (list availability check during slot suggestion). Connectivity: Scheduling → Validates inventory for linked list (e.g., warn "Low 12" Flex Duct" – suggest reschedule); confirmation deducts/reserves stock. App flow: Calendar event detail embeds material preview (transfer updates from job list).
  - **Invoices/Expenses/Employees**: Employees for tech calendars (FK to availability); invoices from completed events. Connectivity: Tech assignment → Pulls rates for duration est. (transfer to job labor); expense creation for overtime/travel (from event duration/site distance). App flow: From employee detail, "View Calendar" filters their jobs (data to time clock); multi-tech events (e.g., large install) share slots.
  - **ServiceAgreements/QuickNotes**: Agreements auto-populate recurring events (FK for series); quick notes import to event notes (e.g., "Site Access" category).
  - **Shared Data Flow**: Estimate approval (transfer priority/site/assets/lists) → Calendar suggest slot (prepopulate from customer/company territorial, employee certs/inventory) → Confirm event (update job status/date, reserve materials) → Execution (mobile tech updates duration/time entries) → Completion (transfer to invoice/expenses, append asset/site history) → Reports (e.g., "Tech Utilization" from events). For multi-site: "Batch Schedule" duplicates events across sites (shared data like lists). Robust views: "CalendarConflictView" (joins for overbooks); "TerritorialScheduleView" (filters by company contact).

**Layout & Sections** (Desktop Web Focus: Interactive Grid with Overlays, Responsive for Mobile List-Stacking):
- **Main View (/calendar)**: Full calendar (daily/weekly/monthly toggle – grid with time slots; events as colored blocks: Red emergency, yellow standard – draggable/resizable for changes). Left sidebar: Filters (by tech/customer/site/priority – prepopulated dropdowns customizable), Resource View (tech calendars stacked). Top: Date navigator, Quick Create button (new event form). Responsive: Mobile collapses to list (events by day with expand for details).
- **Focused View (/calendar/{date})**: Daily agenda (list of events with timelines: Start/End/Tech/Site/Map Link/Status – sortable). Embedded for jobs/customers (filtered view).
- **Detail View (/jobs/{id} – Calendar Integrated)**: Event "card" with job info (as jobs page, but calendar-focused).
  - **Header**: Event/Job #/Status (dropdown update), Quick Actions ( "Reschedule/Assign Tech/Cancel" – drag to calendar if embedded).
  - **Core Schedule Section**: Date/Time/Duration (editable picker with conflict checker), Tech Assignment (dropdown by cert/availability – customizable).
  - **Linked Entities Accordion**: "Site/Customer/Company" (details with territorial contact), "Assets/Materials" (embedded lists with multi-asset grouping).
  - **Work Order/Notes Accordion**: Checklist (from job), quick notes import.
  - **Footer**: "Sync to External Calendar" (export), related events (e.g., "Conflicting Slots").
- **Create/Edit View**: Form with calendar preview (suggest slots on save).

**UX Interactions & Flows**:
- **Scheduling Flow**: Quick create → Prepopulate from job/estimate (dropdown suggests techs by cert/site proximity) → Drag to slot (auto-check conflicts/inventory) → Confirm updates job (transfer to status).
- **Connectivity Flow**: From detail, "Assign Tech" → Dropdown pulls employees (data to time est.); reschedule drag → Rechecks materials (from linked list).
- **Main to Detail**: Filter "Emergency for Territorial Contacts" → Click event → Detail with work order expanded; for multi-site companies, filter groups by site.
- **User Journey**: Office from estimate (multi-site landlord) → Convert/schedule batch (prepopulate shared lists/sites) → Dispatch to tech (territorial filter) → Tech mobile views calendar (their slots only) → Update status (transfer to invoice, update assets).
- **Efficiency Features**: Prepopulated dropdowns (techs/priorities – customizable add/edit/remove); auto-optimize (e.g., suggest slots by travel geo from sites); search events by job #.

**Customizations & Configurability**:
- Admins: Add/edit/remove enums (e.g., Status: Add "Delayed"; add views like "By Trade Category"); customize rules (e.g., min buffer between events); toggle integrations (e.g., require inventory check). Per-role: Techs view their calendar only (mobile); dispatchers drag/full edit.
- Quick Notes: Import to event notes (e.g., "Dispatch" category auto-appends as instruction).

**Edge Cases & Robustness**:
- Multi-Site Schedules: Handle "One Calendar, Batch Events" (e.g., linked for landlord estates – grouped drags); "Territorial Views" (contact-specific filters/edits).
- Conflicts: Overlay prompt "Resolve Overbook?" with alternatives.
- Large Calendars: Infinite scroll for monthly; filter limits (e.g., "My Jobs Only").
- Permissions: Techs update their event status/time; dispatchers reschedule all. Hidden tech details for customers.
- Offline: Mobile caches personal calendar (update local, sync with conflict resolution – e.g., "Slot Changed Offline – Merge?").

**Integrations & Automation**:
- Triggers: Slot confirm → Notification (SMS to tech/customer/contact); due from asset/agreement → Auto-event draft.
- External: Google/Outlook Calendar sync (export/import events); Maps for geo-optimization (travel time calcs from sites).
- Workflow Ties: Quick links ensure progression (e.g., "From Calendar to Job Detail" → Opens with event data, transferring to materials/time). For companies: Territorial auto-notify (e.g., alert right contact on schedule changes).

**Mobile Considerations**:
- Main view as daily list (swipe to next/prev day); detail as vertical scroll with accordions (tap expand work order). Mobile dispatch: Clean tech-only UI with status swipe, voice for notes, GPS for auto "EnRoute". Offline cache prioritizes tech's schedule (update local, sync updates job/status/assets). Responsive grids collapse to lists; embedded in jobs as bottom sheet for quick reschedule, ensuring techs can manage on-the-go without rework.