warranty/repairs for WebUi OneManVanFSM

### Warranty Claims & Service History Page - Exhaustive Description

**Routes**: `/servicehistory` (main list/dashboard view for browsing, searching, and managing all warranty claims and non-warranty service records); `/servicehistory/{id}` (detail view for a specific record, including status updates, evidence, and quick actions); `/servicehistory/new` or `/servicehistory/{id}/edit` (create/edit view for logging new claims or history entries). As a separate page (as requested), it stands alone but with deep embeddability for contextual integration as a component or modal in related pages like Assets (e.g., `/assets/{assetId}/servicehistory` to list only that asset's records), Jobs (e.g., `/jobs/{jobId}/servicehistory` to log post-repair history directly from a job), or Customers (e.g., `/customers/{customerId}/servicehistory` to aggregate across sites/assets/companies). This ensures seamless workflow—e.g., while closing a job on a customer's multi-rental site asset (like a furnace repair), open an embedded history logger without leaving, with data (e.g., job details/site from the customer) transferring automatically to prepopulate the form (warranty vs. non-warranty based on asset expiry), reducing steps for the contractor documenting compliance and tracking repeat issues for better upselling (e.g., "This non-warranty filter change is the 3rd this year—suggest an agreement?").

**Purpose & Business Context**:
- The Warranty Claims & Service History page is a dedicated, standalone tool (separate from service agreements as requested) for logging, tracking, resolving, and analyzing all equipment-related service events—distinguishing warranty claims (e.g., manufacturer-covered defects like a faulty compressor under 5-year warranty) from non-warranty history (e.g., routine wear-and-tear repairs like duct sealing paid out-of-pocket)—serving as the "repair archive" that builds a narrative for each asset's life. For a small HVAC contractor, it captures the ongoing maintenance story: E.g., a warranty claim for refrigerant leak on a company's territorial site asset (submitted with evidence like photos/serial from the job), or non-warranty history for a landlord's multi-rental boilers (tracking "Annual Cleanings" across sites to spot patterns like frequent rust issues, suggesting upgrades). Presentation emphasizes differentiation: List views separate warranty/non-warranty with timelines and status overviews (e.g., "Open Claim: Denied – Appeal?"), while details provide a "service ticket" with evidence chains and resolution paths for audits or customer transparency.
- HVAC-specific: Prioritizes warranty details like refrigerant type/quantity for EPA claims, or non-warranty logs for seasonal wear (e.g., insulation wrap degradation in attics), with prepopulated customizable dropdowns for common issues (e.g., "Leak: Sealant Applied" editable to add "Overcharge" for diagnostics). Generic foundation: Adaptable for other trades without app rework—e.g., repurpose "Refrigerant Claim" for "Pipe Corrosion Warranty" in plumbing (material defects with water quality notes) or "Wiring Fault" in electrical (overload claims with amp readings), using customizable issue types to adjust while maintaining core tracking (dates/evidence/resolutions/costs). This supports relationships: Claims/history tie directly to customers/sites/companies/assets for holistic views (e.g., multi-site claims batch for a chain, filtered by territorial contact to route appeals correctly).
- Business value: Promotes user-friendly efficiency by automating shared data transfer—e.g., a job completion auto-logs non-warranty history (prepopulate from job materials/tech/site), a warranty claim pulls asset install date/serial/warranty expiry (flow to submission with evidence from quick notes), and resolutions update customer summaries for upselling (e.g., "Frequent Non-Warranty Fixes—Propose Agreement?"). Industry thinking: Contractors use history for warranties (e.g., avoid costs by quick claims) and patterns (e.g., recurring non-warranty issues at a site signal systemic problems like poor insulation); the page supports this with mobile evidence capture for techs (clean UI for photo uploads), prepopulated customizable dropdowns (e.g., "Claim Type: Defect/Leak" editable in settings to add "Vibration Damage"), and shared data (e.g., a claim for a company's store asset links to territorial contact for approval, with site-specific notes from quick notes). For multi-site customers/companies (e.g., landlords with rentals or chains with divisions), history enables "group analysis" (batch claims across sites/assets, shared resolutions for similar issues like filter clogs), with territorial filtering to route claims correctly (e.g., submit to right vendor for East sites). Overall robustness: As a separate page, it focuses on tracking without cluttering agreements, with connectivity ensuring no lost context—e.g., history from jobs/assets feeds reports for trends, claims link to expenses/invoices for reimbursements, building a complete service narrative for compliance, customer retention, and informed bidding.

**Data Sources & Interconnections** (With Requested Relationships to Customers/Sites/Companies/Assets):
- **Core Entity**: ServiceHistory table (ID PK, Type enum: WarrantyClaim/NonWarrantyRepair – customizable, e.g., add "Preventive Maintenance"; CustomerID/CompanyID/SiteID/AssetID polymorphic FKs for direct relationships; Date/Description/Status enum: Open/Submitted/Approved/Denied/Resolved – customizable; TechID FK; Evidence JSON (photos/notes/receipts/attachments); Cost/Reimbursement/ResolutionNotes; VendorID FK for claims). One-to-Many with ClaimActions (steps like "Submitted to Manufacturer: Date/Response").
- **Sources**: Prepopulates from Jobs (completed details for auto-logs – customizable types like "Warranty Eligible?"), Assets (specs/install date/serial for eligibility – e.g., check warranty expiry), Sites/Customers/Companies (ownership/location/contacts for relationships – prepopulated territorial if company), Settings (default types/statuses/templates – e.g., "Claim Form PDF" for HVAC vendors).
- **Interconnections** (App-Wide Flow for Shared History Data, Emphasizing Requested Relationships):
  - **Customers/Companies**: Many-to-One (History CustomerID/CompanyID FK). Connectivity: History aggregates by customer/company (e.g., "5 Non-Warranty Repairs This Year Across Sites" – patterns for upselling); territorial companies route claims/resolutions to contacts (e.g., approval needed from Jill Dane for West claims). App flow: Customer detail "Service History" embeds filtered view (data transfer to new claim/log); company multi-contacts: Auto-filter history by territory (e.g., East for John Doe); multi-estate customers (e.g., landlords) group by property for batch reviews.
  - **Sites**: Many-to-One (History SiteID FK). Connectivity: Sites group history (e.g., multi-asset repairs at one location – "3 Claims at Rental A"); site detail "History at This Site" pulls records (with multi-site batch for dispersed estates). App flow: Site "Log New Claim/Repair" opens form with site prepopulated (data transfer to location/notes/linked assets); patterns across sites (e.g., "Similar Non-Warranty Issues at Other Properties?") suggest systemic alerts.
  - **Assets**: Many-to-One (History AssetID FK). Connectivity: Assets append history (e.g., "Warranty: Compressor Replacement" updates asset log with resolution/cost); claims validate against asset install/expiry/serial (e.g., auto-denial if out-of-warranty). App flow: Asset detail "Add History/Claim" embeds form (data transfer to type/description from asset specs); multi-assets per site (e.g., zone-specific claims group in views, shared resolutions for similar models).
  - **Jobs/Estimates/Calendar/Material Lists**: One-to-Many (History from JobID). Connectivity: Job completion auto-logs non-warranty/warranty-eligible history (transfer materials/tech/description/cost – data flow to type/evidence); estimates for follow-up work link back (transfer to new history). App flow: Job detail "Log as History/Claim" transfers to form (prepopulate for warranty check); calendar events from agreements append to history on close (e.g., "Preventive Visit: Resolved Minor Issue"); material lists used in repairs transfer to history "Parts" (for claim reimbursements).
  - **Invoices/Expenses/Payments/QuickNotes**: Joins for financials (e.g., claim reimbursement as payment, non-warranty cost as expense). Connectivity: Resolutions create invoices/expenses (transfer to lines/fees); quick notes import to evidence (e.g., "Photo from Site" category). App flow: Financials detail embeds history preview (data to reimbursements); payments on claims update status (e.g., "Resolved – Reimbursed").
  - **ServiceAgreements/Employees/Notifications**: Agreements link history to visits (for warranty within coverage); employees in logs (tech ID for accountability). Connectivity: Notification for claim status changes (to customer/contact/tech); quick note on job → Imports if history-related.
  - **Shared Data Flow**: Job at site/asset (transfer details) → Auto-log non-warranty history (prepopulate type from warranty check) → Manual warranty claim (transfer evidence from job/quick notes) → Resolution (update asset/site/customer/company records, create reimbursement payment/expense) → Reports (e.g., "Claim Success Rate by Asset/Site"). For multi-site: "Batch Log" for landlord estates (shared data like resolutions aggregate for patterns). Robust views: "HistoryPatternView" (joins for trends by customer/site/company/asset); "TerritorialClaimView" (filters by company contact).

**Layout & Sections** (Desktop Web Focus: Ticket-Style with Timelines, Responsive for Mobile Card-Stacking):
- **List View (/servicehistory)**: Table (columns: Record #/Type (Claim/Repair badge – filter dropdown customizable), Linked Customer/Company/Site/Asset (clickable with multi-group badges), Date/Status (badges: Open/Resolved), Resolution Snippet/Cost, Tech – sortable/prepopulated like "Warranty Only" dropdown). Groupable by asset/site/customer/company for pattern analysis. Responsive: Cards with status badges.
- **Detail View (/servicehistory/{id})**: Record "ticket" with sections.
  - **Header**: Record #/Type, Status (dropdown update – customizable rules like "Require Evidence for Resolved"), Quick Actions dropdown ("Resolve/Update Evidence/File Appeal" – prepopulates forms with record data; "Link to Job/Invoice").
  - **Core Info Section**: Linked Customer/Company/Contact (territorial dropdown if company), Site/Link (address/map), Asset/Link (specs/history – multi-asset if grouped).
  - **Description & Evidence Accordion**: Text/Notes (quick note import), Attachments (photos/receipts/PDFs/forms – upload/view; customizable required for claims).
  - **Resolution & Actions Accordion**: Status Timeline (changes/dates/users), Resolution Notes/Cost/Reimbursement (link to payment/expense), ClaimActions Table (steps like "Submitted: Date/Response").
  - **Connections Accordion**: "Related History" (other records for same asset/site – links); "Linked Job/Invoice/Expense" (from originating work).
  - **Footer**: "Export PDF/CSV" (with evidence for submissions), related links (e.g., "View Patterns for Asset" filtered).
- **Edit/Create View**: Form mirroring detail, with relationship linker (multi-select customer/site/company/asset – customizable defaults).

**UX Interactions & Flows**:
- **Logging Flow**: Create from asset/job (prepopulate all) → Select type (dropdown customizable) → Add evidence (photo/voice/receipt) → Resolve (update status, transfer to reimbursement payment/expense).
- **Connectivity Flow**: From detail, "Link to Asset/Site" → Dropdown pulls from customer/company (data transfer to relationships); resolution "Reimburse" embeds payment form (transfer to financials).
- **List to Detail**: Filter "Open Claims for Territorial Contacts" → Click record → Detail with evidence expanded; for multi-site companies, filter groups by site.
- **User Journey**: Tech from job (company with chain stores) → Log non-warranty repair (prepopulate from job/site/asset) → Office views history (territorial filter) → File warranty claim (transfer evidence) → Resolve (update asset, reimburse via payment) → Customer summary updates (patterns for upselling).
- **Efficiency Features**: Prepopulated dropdowns (types/status – customizable add/edit/remove); auto-pattern detection (e.g., "Similar Issues on Other Assets – View?"); search records by asset serial across app.

**Customizations & Configurability**:
- Admins: Add/edit/remove enums (e.g., Type: Add "Recall"; Status: Add "In Progress"); customize evidence requirements (e.g., mandate receipt for non-warranty); toggle fields (e.g., add "Vendor ID" for HVAC manufacturers). Per-role: Techs log evidence/status (from jobs); office resolves/full edit.
- Quick Notes: Import to description (e.g., "Evidence" category auto-appends as attachment).

**Edge Cases & Robustness**:
- Multi-Relationships: Handle "One Record, Multiple Assets/Sites" (e.g., batch claims for landlord estates – grouped resolutions); "Territorial Claims" (contact-specific alerts/edits).
- Incomplete Evidence: Block resolution (e.g., "Add Photo/Receipt First?").
- Large Histories: Pagination in lists/history; filter limits (e.g., "By Asset Only").
- Permissions: Techs create logs (from jobs); managers resolve claims. Hidden costs for techs.
- Offline: Mobile caches draft records (log local, sync with merge – e.g., "Duplicate Resolution – Resolve?").

**Integrations & Automation**:
- Triggers: New log from job → Alert (e.g., "Review for Warranty?"); resolution → Notify customer/contact/tech; pattern detected → Upsell suggestion (e.g., to agreements).
- External: Manufacturer API for claim submission (auto-fill from asset specs); PDF export for claim forms (with evidence).
- Workflow Ties: Quick links ensure progression (e.g., "From History to New Job" → Prepopulates scheduler with sites/assets/previous resolution, transferring data). For companies: Territorial auto-notify (e.g., alert right contact for claim updates).

**Mobile Considerations**:
- List as type-filtered cards (swipe to view detail/log new); detail as vertical scroll with accordions (tap expand evidence). Mobile logging: Clean form with camera for photos/receipts, voice for notes. Offline cache prioritizes tech's job-linked records (log local, sync appends to asset/site history). Responsive layouts stack groups to lists; embedded in assets/jobs as bottom sheet for quick logging, ensuring techs can record on-site without rework.