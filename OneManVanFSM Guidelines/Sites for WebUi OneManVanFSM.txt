Sites for WebUi OneManVanFSM

### Sites Page - Exhaustive Description

**Routes**: `/sites` (list view for browsing and searching all sites across customers/companies); `/sites/{id}` (detail view for a specific site, including linked assets, jobs, and quick actions); `/sites/new` or `/sites/{id}/edit` (create/edit view for adding or updating sites). For contextual integration, embeddable as a component or modal in related pages like Customers (e.g., `/customers/{customerId}/sites` to list only that customer's or company's sites) or Assets (e.g., `/assets/{assetId}/sites` for assigning or viewing site context). This ensures seamless workflow—e.g., while viewing a customer's detail, add a new site without leaving, with data (e.g., customer/company ownership) transferring automatically to prepopulate the form, reducing steps for the contractor managing multi-location clients.

**Purpose & Business Context**:
- The Sites page is envisioned as the dedicated manager for all physical locations tied to customers or companies, serving as the "spatial organizer" that bridges client data with on-the-ground operations. For a small HVAC contractor, it captures the reality of diverse setups: A residential customer might have one home site with multiple assets (e.g., a furnace in the basement and an AC unit on the roof), while a landlord owns multiple rental sites (each with varying assets like boilers per unit) or a company has dispersed commercial locations (e.g., stores with rooftop units per territory). Presentation focuses on practicality: List views provide quick scans with maps and status overviews (e.g., "Site A: 2 Assets Needing Maintenance"), while details offer a "site profile" with access notes, asset groupings, and job timelines—enabling efficient dispatching (e.g., "Gate code for Rental B: 1234, park in back for furnace access").
- HVAC-specific: Emphasizes site attributes like square footage/zones/stories (from pasted-text template) for load calculations, equipment locations (e.g., "Attic Ductwork"), or environmental factors (e.g., "High Humidity – Suggest Dehumidifier Add-On"), with alerts for site-specific compliance (e.g., fire damper requirements in multi-story buildings). Generic foundation: Adaptable for other trades without app changes—e.g., repurpose "Zones" for "Circuit Zones" in electrical (panels per floor) or "Water Zones" in plumbing (fixtures per bathroom), using customizable fields to adjust terminology while maintaining core tracking (access instructions, asset groupings). This supports complex scenarios: A customer with multiple estates (e.g., primary home + vacation properties, each with one or more assets) or a company with territorial divisions (e.g., sites filtered by contact, ensuring the right person gets notified for East County repairs).
- Business value: Promotes user-friendly efficiency by centralizing location data that flows everywhere—e.g., site details (address/geo) prepopulate in job scheduling/maps, access notes transfer to work orders for techs, and asset groupings inform material lists (no re-entering "Sq Ft: 2000, Zones: 3" across pages). Industry thinking: Contractors navigate varied sites daily (e.g., gate codes for gated communities, parking for urban rentals); the page supports this with mobile-friendly quick views and shared data (e.g., a site's recent repair glance pulls from jobs to suggest preventive bids). For multi-site customers/companies (e.g., landlords with rentals or chains with stores), sites enable "group management" (batch scheduling across sites, shared templates for similar assets), with territorial filtering to route workflows correctly (e.g., notify Jill Dane for West sites). Overall robustness: Connectivity ensures no isolated locations—e.g., a site's assets link back to inventory/products for stock checks, and jobs update site history for compliance/warranty tracking, reducing oversights in repeat business.

**Data Sources & Interconnections**:
- **Core Entity**: Sites table (ID PK, CustomerID/CompanyID polymorphic FK for ownership; Name/Address/City/State/Zip/Country/GeoCoords (latitude/longitude for maps/scheduling optimization); PropertyType enum: Residential/Commercial/Industrial – customizable; SqFt/Zones/Stories (numeric, prepopulated defaults like "Stories: 1-5" dropdown); AccessCodes/Instructions/Parking/EquipmentLocation (text fields for notes); Notes). One-to-Many with Assets (SiteID FK); RepairHistory indirectly via assets/jobs.
- **Sources**: Prepopulates from Customers/Companies (ownership/address inheritance – customizable overrides per site); Settings (default property types/access templates – e.g., "Gated Community Code Format").
- **Interconnections** (App-Wide Flow for Shared Location Data):
  - **Customers/Companies**: Many-to-One (Site CustomerID/CompanyID FK). Connectivity: Sites inherit customer/company data (e.g., primary contact/phone) but allow overrides (e.g., site-specific territorial contact from company's multi-contacts). App flow: Customer detail "Sites Summary" embeds filtered list (with quick glances: "Site A: 3 Assets, Recent Repair: AC at Basement"); adding site from customer page prepopulates ownership (data transfer: Address from customer, territorial contact if company-linked); multi-sites per customer (e.g., landlord estates) group in views with shared summaries (e.g., "Total Sq Ft Across Sites: 5000").
  - **Assets**: One-to-Many (Asset SiteID FK). Connectivity: Assets group by site (e.g., multiple furnaces per rental unit); site detail "Assets at This Location" table pulls linked assets (with multi-asset handling, e.g., "Zone 1: Furnace; Zone 2: AC"). App flow: Asset create/search filters by site (prepopulates location/access notes); site "Add Asset" embeds asset form (data transfer to asset fields like EquipmentLocation); repairs on assets append to site history (e.g., "Recent: Duct Sealant at Attic").
  - **Products/Inventory**: Indirect via assets/material lists (Product to Asset via install). Connectivity: Site specs (e.g., Sq Ft/Zones) suggest products in material builder (e.g., "Recommend 14" Flex Duct for 3-Story"); inventory deductions for site installs update site-linked assets. App flow: From site detail, "Build Material List for Site" opens builder prepopulated with asset needs (data transfer from site specs to list sections like Trunk: Main Size based on zones).
  - **Estimates/Jobs/MaterialLists**: Many-to-One (Estimate/Job/MaterialList SiteID FK). Connectivity: Site selected in estimate/job prepopulates material list sections (e.g., "Stories: 2" suggests more "Floor Boots"); job history appends to site (e.g., "Upcoming: Maintenance at This Site"). App flow: Job scheduler embeds site selector (data transfer: Access instructions to work order notes); material list import to job validates against site assets (e.g., match existing "20x20 Returns").
  - **Invoices/Expenses/ServiceAgreements**: Joins for site-specific billing (e.g., permit fees per site location/jurisdiction). Connectivity: Agreements cover multi-sites (e.g., recurring list for all landlord rentals); invoices pull site address/access for delivery notes. App flow: Invoice generate from job embeds site details (data transfer to disposal/permits sections).
  - **QuickNotes/Documents/Employees**: Polymorphic notes/docs per site (import quick notes for "Access Update"); employee dispatch pulls site instructions. Connectivity: Quick note on job → Imports to site if location-related (e.g., "Parking: Back Lot Full – Note Added").
  - **Shared Data Flow**: Customer/company creates primary site (inherit address/contact) → Add site details (transfer to new assets/jobs) → Build material list from site specs (prepopulate sections) → Job at site deducts inventory/creates assets (update site history) → Repair job appends to site/asset (suggest products from templates) → Invoice bills with site fees (transfer to expenses if variances) → Reports (e.g., "Site Repair Trends" across customer estates). For territorial companies: Site "Assign Contact" dropdown (from company multi-contacts) routes notifications/workflows. Robust views: "SiteAssetView" (joins for multi-asset groupings); "MultiSiteSummaryView" (aggregates Sq Ft/jobs for landlords/companies).

**Layout & Sections** (Desktop Web Focus: Map-Centric with Groupings, Responsive for Mobile Card-Stacking):
- **List View (/sites)**: Searchable table (columns: Name/Owner (Customer/Company – clickable), Address/GeoLink (maps integration), Property Type (dropdown filter – customizable), Sq Ft/Zones/Stories, Assets Count (with multi-asset badge), Open Jobs/Recent Repair Glance, Access Snippet – sortable/prepopulated like "Residential Only" dropdown). Groupable by customer/company for multi-site overviews. Responsive: Cards with map thumbnails.
- **Detail View (/sites/{id})**: Location-focused profile with tabs/accordions.
  - **Header**: Name (editable), Owner Link (customer/company with territorial contact dropdown if applicable), Quick Actions dropdown ("Add Asset/New Job/Estimate" – prepopulates with site data; "Update Access/Map").
  - **Core Info Section**: Address/GeoCoords (editable map preview), Property Type/Sq Ft/Zones/Stories (prepopulated dropdowns/numerics – customizable), Access Codes/Instructions/Parking/Equipment Location (text fields with quick note import).
  - **Assets at Site Accordion**: Grouped table (for multi-assets: Columns: Name/Type/Install Date/Status/Recent Repair Link – filterable by zone/story).
  - **Jobs & History Accordion**: Recent/Upcoming tables (with site-specific glances: "Last Repair: Ductwork at Attic (Job #123)"); shared across multi-assets.
  - **Notes & Documents Accordion**: Quick notes feed (import for site-specific), docs (e.g., blueprint PDF – upload/view).
  - **Footer**: "Export Site PDF/CSV" (with assets/jobs summary), related links (e.g., "View All for Owner" filtered by customer).
- **Edit/Create View**: Form mirroring detail, with owner selector (search customers/companies – prepopulates address/contact).

**UX Interactions & Flows**:
- **Site Management Flow**: On create (e.g., from customer), prepopulate from owner (address/contact) → Add access notes (voice for mobile); for multi-sites, "Duplicate for Batch" clones with overrides.
- **Connectivity Flow**: From detail, "Add Asset" → Opens asset form with site prepopulated (data transfer to location fields); job "Schedule at This Site" transfers access instructions/notes.
- **List to Detail**: Filter "Multi-Asset Sites for Landlords" → Click site → Detail with assets accordion expanded; for companies, filter by territorial contact (e.g., show West sites for Jill Dane).
- **User Journey**: From customer (company with chain stores) → Add site → Prepopulate territorial contact → Add multi-assets (batch form) → Schedule job (transfer site data to work order) → Tech views site detail on mobile (access codes/maps) → Log repair (appends history).
- **Efficiency Features**: Prepopulated dropdowns (property types/zones – customizable add/edit/remove); auto-map geo (address to coords for navigation); search integrates site names across app.

**Customizations & Configurability**:
- Admins: Add/edit/remove dropdowns (e.g., Property Type: Add "Apartment Complex"; add fields like "Roof Access" for HVAC); set default groupings (e.g., by zone for multi-story). Per-role: Techs view access/notes only (no edit); dispatchers assign territorial contacts.
- Quick Notes: Import to instructions (e.g., "Access" category auto-appends as code/note).

**Edge Cases & Robustness**:
- Multi-Asset/Site: Handle "One Customer, Dispersed Sites" (e.g., estate-wide filters with shared history); "Company Territorial" (contact-specific views/edits).
- No Assets/Jobs: Empty state actionable (e.g., "Add First Asset?" opens form prepopulated).
- Large Sites: Pagination in assets/jobs tables; search within accordions.
- Permissions: Techs log site notes (e.g., during visit); managers edit core info. Hidden financial links (e.g., site value) for non-owners.
- Offline: Mobile caches assigned sites (view access/maps local, sync notes/history with merge).

**Integrations & Automation**:
- Triggers: Site add with assets → Alert (e.g., "Schedule Initial Inspection?"); repair history milestone (e.g., 1 year post-install) → Auto-job draft.
- External: Google Maps for geo/address validation/navigation; PDF export for site blueprints (with assets marked).
- Workflow Ties: Quick links ensure progression (e.g., "From Site to Material List" → Prepopulates builder with site specs/zones, transferring to job estimates). For companies: Territorial auto-routing (e.g., notify right contact for site issues).

**Mobile Considerations**:
- List as filterable cards (swipe to view detail/add note); detail as vertical scroll with accordions (tap expand assets). Add site via camera (e.g., photo for location) or voice notes; offline cache prioritizes tech's assigned sites (log local, sync appends history). Responsive grids stack to lists; embedded modals as bottom sheets for customer-context adding, ensuring techs can manage sites on-the-go without rework.