@page "/documents"
@page "/documents/new"
@page "/documents/{Id:int}"
@page "/documents/{Id:int}/edit"
@rendermode InteractiveServer
@implements IDisposable
@inject IDocumentService DocSvc
@inject ICustomerService CustomerSvc
@inject IJobService JobSvc
@inject IAssetService AssetSvc
@inject ISiteService SiteSvc
@inject IEmployeeService EmployeeSvc
@inject IDropdownService DropdownSvc
@inject NavigationManager Nav
@inject IJSRuntime JS

@using Microsoft.AspNetCore.Components

<PageTitle>Documents - OneManVanFSM</PageTitle>

@if (mode == "form")
{
    <div class="d-flex align-items-center mb-3">
        <button class="btn btn-outline-secondary btn-sm me-2" @onclick="GoToList"><i class="bi bi-arrow-left"></i></button>
        <h4 class="mb-0"><i class="bi bi-folder-fill me-2"></i>@(editId.HasValue ? "Edit" : "Upload") Document</h4>
    </div>
    <div class="card border-0 shadow-sm">
        <div class="card-body">
            <EditForm Model="form" OnValidSubmit="SaveDocument">
                <DataAnnotationsValidator />
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Name <span class="text-danger">*</span></label>
                        <InputText @bind-Value="form.Name" class="form-control" />
                        <ValidationMessage For="() => form.Name" />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Category</label>
                        <InputSelect @bind-Value="form.Category" class="form-select">
                            @foreach (var c in _documentCategories) { <option value="@c">@c</option> }
                        </InputSelect>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Access Level</label>
                        <InputSelect @bind-Value="form.AccessLevel" class="form-select">
                            @foreach (var a in _accessLevels) { <option value="@a">@a</option> }
                        </InputSelect>
                    </div>
                    @if (!editId.HasValue)
                    {
                        <div class="col-12">
                            <label class="form-label">File <span class="text-danger">*</span></label>
                            <InputFile OnChange="OnFileSelected" class="form-control" accept="*/*" />
                            @if (uploadFile is not null)
                            {
                                <small class="text-muted d-block mt-1">
                                    <i class="bi bi-file-earmark me-1"></i>@uploadFile.Name — @FormatSize(uploadFile.Size)
                                </small>
                            }
                        </div>
                    }
                    <div class="col-md-4">
                        <label class="form-label">Customer</label>
                        <InputSelect @bind-Value="form.CustomerId" class="form-select">
                            <option value="">None</option>
                            @if (ddCustomers is not null) { @foreach (var c in ddCustomers) { <option value="@c.Id">@c.Name</option> } }
                        </InputSelect>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Job</label>
                        <InputSelect @bind-Value="form.JobId" class="form-select">
                            <option value="">None</option>
                            @if (ddJobs is not null) { @foreach (var j in ddJobs) { <option value="@j.Id">@j.Title</option> } }
                        </InputSelect>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Asset</label>
                        <InputSelect @bind-Value="form.AssetId" class="form-select">
                            <option value="">None</option>
                            @if (ddAssets is not null) { @foreach (var a in ddAssets) { <option value="@a.Id">@a.Name</option> } }
                        </InputSelect>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Site</label>
                        <InputSelect @bind-Value="form.SiteId" class="form-select">
                            <option value="">None</option>
                            @if (ddSites is not null) { @foreach (var s in ddSites) { <option value="@s.Id">@s.Name</option> } }
                        </InputSelect>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Employee</label>
                        <InputSelect @bind-Value="form.EmployeeId" class="form-select">
                            <option value="">None</option>
                            @if (ddEmployees is not null) { @foreach (var e in ddEmployees) { <option value="@e.Id">@e.Name</option> } }
                        </InputSelect>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Tags</label>
                        <InputText @bind-Value="form.CustomTags" class="form-control" placeholder="tag1, tag2" />
                    </div>
                    <div class="col-12">
                        <label class="form-label">Notes</label>
                        <InputTextArea @bind-Value="form.Notes" class="form-control" rows="2" />
                    </div>
                </div>
                <div class="mt-3">
                    <button type="submit" class="btn btn-primary" disabled="@(isUploading || (!editId.HasValue && uploadFile is null))">
                        @if (isUploading)
                        {
                            <span class="spinner-border spinner-border-sm me-1"></span>
                        }
                        <i class="bi @(editId.HasValue ? "bi-check-lg" : "bi-upload") me-1"></i>@(editId.HasValue ? "Save" : "Upload & Save")
                    </button>
                    <button type="button" class="btn btn-outline-secondary ms-2" @onclick="GoToList">Cancel</button>
                </div>
                @if (!string.IsNullOrEmpty(errorMsg)) { <div class="alert alert-danger mt-2 mb-0">@errorMsg</div> }
            </EditForm>
        </div>
    </div>
}
else if (mode == "detail" && selectedDoc is not null)
{
    <div class="d-flex align-items-center mb-3">
        <button class="btn btn-outline-secondary btn-sm me-2" @onclick="GoToList"><i class="bi bi-arrow-left"></i></button>
        <h4 class="mb-0"><i class="bi bi-file-earmark me-2"></i>@selectedDoc.Name</h4>
        <span class="badge bg-primary ms-2">@selectedDoc.Category</span>
        <span class="badge bg-secondary ms-1">v@selectedDoc.Version</span>
        <span class="badge ms-1 @GetAccessBadge(selectedDoc.AccessLevel)">@selectedDoc.AccessLevel</span>
        <div class="ms-auto d-flex gap-2">
            <button class="btn btn-outline-primary btn-sm" @onclick="EditDoc"><i class="bi bi-pencil me-1"></i>Edit</button>
            <button class="btn btn-outline-primary btn-sm" @onclick="DownloadDoc" disabled="@isDownloading">
                @if (isDownloading)
                {
                    <span class="spinner-border spinner-border-sm me-1"></span>
                }
                <i class="bi bi-download me-1"></i>Download
            </button>
            @if (_confirmDelete)
            {
                <button class="btn btn-danger btn-sm me-1" @onclick="async () => { _confirmDelete = false; await DeleteDoc(); }"><i class="bi bi-exclamation-triangle me-1"></i>Confirm Delete</button>
                <button class="btn btn-outline-secondary btn-sm" @onclick="() => _confirmDelete = false">Cancel</button>
            }
            else
            {
                <button class="btn btn-outline-danger btn-sm" @onclick="() => _confirmDelete = true"><i class="bi bi-trash me-1"></i>Delete</button>
            }
        </div>
    </div>
                 <div class="row g-2">
        <div class="col-md-8">
            @* -- Inline Preview Panel -- *@
            @if (IsPreviewable(selectedDoc.FileType))
            {
                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-header bg-white d-flex align-items-center">
                        <strong><i class="bi bi-eye me-1"></i>Preview</strong>
                        <button class="btn btn-sm btn-outline-secondary ms-auto" @onclick="() => _previewExpanded = !_previewExpanded" title="@(_previewExpanded ? "Collapse" : "Expand")">
                            <i class="bi @(_previewExpanded ? "bi-arrows-angle-contract" : "bi-arrows-angle-expand")"></i>
                        </button>
                    </div>
                    <div class="card-body p-0" style="overflow:hidden;">
                        @if (IsImageFile(selectedDoc.FileType))
                        {
                            <div class="text-center p-3" style="background:#f8f9fa;">
                                <img src="/uploads/@selectedDoc.StoredFileName" alt="@selectedDoc.Name" class="img-fluid" style="max-height:@(_previewExpanded ? "80vh" : "450px"); border-radius:4px;" />
                            </div>
                        }
                        else if (IsPdfFile(selectedDoc.FileType))
                        {
                            <iframe src="/uploads/@selectedDoc.StoredFileName" style="width:100%; height:@(_previewExpanded ? "80vh" : "550px"); border:none;"></iframe>
                        }
                    </div>
                </div>
            }

            <div class="card border-0 shadow-sm mb-3">
                <div class="card-header bg-white"><strong><i class="bi bi-file-earmark-text me-1"></i>File Information</strong></div>
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-sm-4"><small class="text-muted d-block">File Type</small><span>@(selectedDoc.FileType ?? "\u2014")</span></div>
                        <div class="col-sm-4"><small class="text-muted d-block">File Size</small><span>@FormatSize(selectedDoc.FileSize)</span></div>
                        <div class="col-sm-4"><small class="text-muted d-block">Version</small><span>@selectedDoc.Version</span></div>
                        <div class="col-sm-4"><small class="text-muted d-block">Category</small><span class="badge bg-primary">@selectedDoc.Category</span></div>
                        <div class="col-sm-4"><small class="text-muted d-block">Access Level</small><span class="badge @GetAccessBadge(selectedDoc.AccessLevel)">@selectedDoc.AccessLevel</span></div>
                        <div class="col-sm-4"><small class="text-muted d-block">Uploaded By</small><span>@(selectedDoc.UploadedByName ?? "\u2014")</span></div>
                    </div>
                </div>
            </div>

            @if (!string.IsNullOrWhiteSpace(selectedDoc.CustomTags))
            {
                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-header bg-white"><strong><i class="bi bi-tags me-1"></i>Tags</strong></div>
                    <div class="card-body">
                        @foreach (var tag in selectedDoc.CustomTags.Split(',', StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries))
                        {
                            <span class="badge bg-secondary me-1">@tag</span>
                        }
                    </div>
                </div>
            }

            <div class="card border-0 shadow-sm mb-3">
                <div class="card-header bg-white"><strong><i class="bi bi-link-45deg me-1"></i>Connections</strong></div>
                <div class="card-body">
                    <div class="row g-2">
                        @if (selectedDoc.CustomerName is not null)
                        {
                            <div class="col-sm-4">
                                <small class="text-muted d-block">Customer</small>
                                <a href="javascript:void(0)" @onclick="GoToCustomer">@selectedDoc.CustomerName</a>
                            </div>
                        }
                        @if (selectedDoc.SiteName is not null)
                        {
                            <div class="col-sm-4">
                                <small class="text-muted d-block">Site</small>
                                <a href="javascript:void(0)" @onclick="GoToSite">@selectedDoc.SiteName</a>
                            </div>
                        }
                        @if (selectedDoc.AssetName is not null)
                        {
                            <div class="col-sm-4">
                                <small class="text-muted d-block">Asset</small>
                                <a href="javascript:void(0)" @onclick="GoToAsset">@selectedDoc.AssetName</a>
                            </div>
                        }
                        @if (selectedDoc.JobTitle is not null)
                        {
                            <div class="col-sm-4">
                                <small class="text-muted d-block">Job</small>
                                <a href="javascript:void(0)" @onclick="GoToJob">@selectedDoc.JobTitle</a>
                            </div>
                        }
                        @if (selectedDoc.EmployeeName is not null)
                        {
                            <div class="col-sm-4">
                                <small class="text-muted d-block">Employee</small>
                                <a href="javascript:void(0)" @onclick="GoToEmployee">@selectedDoc.EmployeeName</a>
                            </div>
                        }
                        @if (selectedDoc.CustomerName is null && selectedDoc.SiteName is null && selectedDoc.AssetName is null && selectedDoc.JobTitle is null && selectedDoc.EmployeeName is null)
                        {
                            <div class="col-12"><span class="text-muted">No linked entities</span></div>
                        }
                    </div>
                </div>
            </div>

            @if (!string.IsNullOrWhiteSpace(selectedDoc.Notes))
            {
                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-header bg-white"><strong><i class="bi bi-journal-text me-1"></i>Notes</strong></div>
                    <div class="card-body"><p class="text-muted small mb-0">@selectedDoc.Notes</p></div>
                </div>
            }
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-body">
                    <h6 class="text-muted mb-2">Quick Actions</h6>
                    <a href="/assets" class="btn btn-outline-secondary btn-sm w-100 mb-2"><i class="bi bi-cpu me-1"></i>View Assets</a>
                    <a href="/jobs" class="btn btn-outline-secondary btn-sm w-100 mb-2"><i class="bi bi-briefcase me-1"></i>View Jobs</a>
                    <a href="/customers" class="btn btn-outline-secondary btn-sm w-100"><i class="bi bi-people me-1"></i>View Customers</a>
                    <div class="d-flex justify-content-between text-muted small mt-2 pt-2 border-top">
                        <span><i class="bi bi-clock-history me-1"></i>Uploaded @selectedDoc.UploadDate.ToString("MMM dd, yyyy h:mm tt")</span>
                        <span>Created @selectedDoc.CreatedAt.ToString("MMM dd, yyyy h:mm tt")</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0"><i class="bi bi-folder-fill me-2"></i>Documents</h4>
        <button class="btn btn-primary btn-sm" @onclick="GoToNew"><i class="bi bi-upload me-1"></i>Upload</button>
    </div>
    <div class="card border-0 shadow-sm mb-3">
        <div class="card-body py-2">
            <div class="row g-2 align-items-end">
                <div class="col-md-4">
                    <input type="text" class="form-control form-control-sm" placeholder="Search documents..." @bind="filter.Search" @bind:event="oninput" @bind:after="LoadDocuments" />
                </div>
                <div class="col-md-3">
                    <select class="form-select form-select-sm" @bind="filterCategory" @bind:after="LoadDocuments">
                        <option value="">All Categories</option>
                        @foreach (var c in _documentCategories) { <option value="@c">@c</option> }
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select form-select-sm" @bind="filterEntity" @bind:after="LoadDocuments">
                        <option value="">All Entities</option>
                        <option value="Customer">Customer</option>
                        <option value="Site">Site</option>
                        <option value="Asset">Asset</option>
                        <option value="Job">Job</option>
                        <option value="Employee">Employee</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <div class="card border-0 shadow-sm">
        @if (documents is null)
        {
            <div class="card-body text-center py-4"><div class="spinner-border spinner-border-sm"></div></div>
        }
        else if (!documents.Any())
        {
            <div class="card-body text-center py-5 text-muted"><i class="bi bi-folder" style="font-size:3rem;"></i><p class="mt-2">No documents. <a href="javascript:void(0)" @onclick="GoToNew">Upload one</a>.</p></div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-hover mb-0 align-middle">
                    <thead class="table-light"><tr><th>Name</th><th>Category</th><th>Type</th><th>Size</th><th>Access</th><th>Customer</th><th>Job</th><th>Uploaded</th></tr></thead>
                    <tbody>
                        @foreach (var doc in documents)
                        {
                            <tr style="cursor:pointer" @onclick="() => GoToDetail(doc.Id)">
                                <td><i class="bi @GetFileIcon(doc.FileType) me-1"></i><strong>@doc.Name</strong></td>
                                <td><span class="badge bg-primary">@doc.Category</span></td>
                                <td>@(doc.FileType ?? "\u2014")</td>
                                <td>@FormatSize(doc.FileSize)</td>
                                <td><span class="badge @GetAccessBadge(doc.AccessLevel)">@doc.AccessLevel</span></td>
                                <td>@(doc.CustomerName ?? "\u2014")</td>
                                <td>@(doc.JobTitle ?? "\u2014")</td>
                                <td>@doc.UploadDate.ToString("MMM dd, yyyy")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
}

@code {
    [Parameter]
    public int? Id { get; set; }
    private bool _confirmDelete;

    private string mode = "list";
    private List<DocumentListItem>? documents;
    private DocumentFilter filter = new();
    private string filterCategory = "";
    private string filterEntity = "";
    private DocumentDetail? selectedDoc;
    private DocumentEditModel form = new();
    private int? editId;
    private string? errorMsg;
    private IBrowserFile? uploadFile;
    private bool isUploading;
    private bool isDownloading;
    private bool _previewExpanded;
    private List<CustomerListItem>? ddCustomers;
    private List<JobListItem>? ddJobs;
    private List<AssetListItem>? ddAssets;
    private List<SiteListItem>? ddSites;
    private List<EmployeeListItem>? ddEmployees;

    private List<string> _documentCategories = Enum.GetValues<DocumentCategory>().Select(c => c.ToString()).ToList();
    private List<string> _accessLevels = Enum.GetValues<DocumentAccessLevel>().Select(a => a.ToString()).ToList();

    protected override void OnInitialized()
    {
        Nav.LocationChanged += OnLocationChanged;
    }

    protected override async Task OnParametersSetAsync()
    {
        await DetermineView();
    }

    private async void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        await DetermineView();
        await InvokeAsync(StateHasChanged);
    }

    private async Task DetermineView()
    {
        var uri = Nav.ToAbsoluteUri(Nav.Uri);
        if (uri.AbsolutePath.Contains("/documents/new", StringComparison.OrdinalIgnoreCase))
        {
            mode = "form"; editId = null; form = new(); uploadFile = null;
            await LoadDropdowns();
        }
        else if (Id.HasValue && uri.AbsolutePath.Contains("/edit", StringComparison.OrdinalIgnoreCase))
            await LoadForEdit(Id.Value);
        else if (Id.HasValue)
            await LoadDetail(Id.Value);
        else { mode = "list"; await LoadDocuments(); }
    }

    public void Dispose()
    {
        Nav.LocationChanged -= OnLocationChanged;
    }

    private async Task LoadDropdowns()
    {
        ddCustomers ??= await CustomerSvc.GetCustomersAsync();
        ddJobs ??= await JobSvc.GetJobsAsync();
        ddAssets ??= await AssetSvc.GetAssetsAsync();
        ddSites ??= await SiteSvc.GetSitesAsync();
        ddEmployees ??= await EmployeeSvc.GetEmployeesAsync();
        var cats = await DropdownSvc.GetOptionsAsync("DocumentCategory");
        if (cats.Count > 0) _documentCategories = cats.Where(o => o.IsActive).Select(o => o.Value).ToList();
        var als = await DropdownSvc.GetOptionsAsync("DocumentAccessLevel");
        if (als.Count > 0) _accessLevels = als.Where(o => o.IsActive).Select(o => o.Value).ToList();
    }

    private void OnFileSelected(InputFileChangeEventArgs e)
    {
        uploadFile = e.File;
        if (string.IsNullOrWhiteSpace(form.Name))
            form.Name = Path.GetFileNameWithoutExtension(uploadFile.Name);
    }

    private async Task LoadDocuments()
    {
        filter.Category = string.IsNullOrWhiteSpace(filterCategory) ? null : Enum.Parse<DocumentCategory>(filterCategory);
        filter.EntityType = string.IsNullOrWhiteSpace(filterEntity) ? null : filterEntity;
        documents = await DocSvc.GetDocumentsAsync(filter);
    }

    private async Task LoadDetail(int id)
    {
        selectedDoc = await DocSvc.GetDocumentAsync(id);
        mode = selectedDoc is not null ? "detail" : "list";
        if (mode == "list") await LoadDocuments();
    }

    private async Task LoadForEdit(int id)
    {
        var d = await DocSvc.GetDocumentAsync(id);
        if (d is null) { mode = "list"; await LoadDocuments(); return; }
        editId = id;
        form = new DocumentEditModel
        {
            Name = d.Name, Category = d.Category, AccessLevel = d.AccessLevel,
            CustomTags = d.CustomTags, Notes = d.Notes,
            CustomerId = d.CustomerId, SiteId = d.SiteId, AssetId = d.AssetId,
            JobId = d.JobId, EmployeeId = d.EmployeeId
        };
        mode = "form";
        await LoadDropdowns();
    }

    private async Task SaveDocument()
    {
        try
        {
            errorMsg = null;
            isUploading = true;
            if (editId.HasValue)
            {
                await DocSvc.CreateDocumentAsync(form); // Update via create for metadata-only edits
                Nav.NavigateTo("/documents");
            }
            else
            {
                if (uploadFile is null) { errorMsg = "Please select a file to upload."; return; }
                await using var stream = uploadFile.OpenReadStream(maxAllowedSize: 100 * 1024 * 1024);
                await DocSvc.UploadDocumentAsync(form, stream, uploadFile.Name, uploadFile.Size);
                Nav.NavigateTo("/documents");
            }
        }
        catch (Exception ex) { errorMsg = ex.Message; }
        finally { isUploading = false; }
    }

    private async Task DownloadDoc()
    {
        if (selectedDoc is null) return;
        try
        {
            isDownloading = true;
            var result = await DocSvc.DownloadDocumentAsync(selectedDoc.Id);
            if (result is null) { errorMsg = "File not found on server."; return; }
            var (stream, contentType, fileName) = result.Value;
            await using (stream)
            {
                using var ms = new MemoryStream();
                await stream.CopyToAsync(ms);
                var base64 = Convert.ToBase64String(ms.ToArray());
                await JS.InvokeVoidAsync("eval",
                    $"(() => {{ var a=document.createElement('a'); a.href='data:{contentType};base64,{base64}'; a.download='{fileName.Replace("'", "\\'")}'; document.body.appendChild(a); a.click(); a.remove(); }})()");
            }
        }
        catch (Exception ex) { errorMsg = ex.Message; }
        finally { isDownloading = false; }
    }

    private async Task DeleteDoc()
    {
        if (selectedDoc is not null) { await DocSvc.DeleteDocumentAsync(selectedDoc.Id); Nav.NavigateTo("/documents"); }
    }

    private string FormatSize(long? size) => size switch
    {
        null => "\u2014",
        < 1024 => $"{size} B",
        < 1048576 => $"{size / 1024.0:F1} KB",
        _ => $"{size / 1048576.0:F1} MB"
    };

    private string GetFileIcon(string? type) => (type?.ToLower()) switch
    {
        "pdf" => "bi-file-earmark-pdf text-danger",
        "image" or "jpg" or "png" => "bi-file-earmark-image text-success",
        "docx" or "doc" => "bi-file-earmark-word text-primary",
        _ => "bi-file-earmark"
    };

    private string GetAccessBadge(DocumentAccessLevel level) => level switch
    {
        DocumentAccessLevel.Public => "bg-success",
        DocumentAccessLevel.Private => "bg-danger",
        DocumentAccessLevel.RoleBased => "bg-warning text-dark",
        DocumentAccessLevel.CustomerOnly => "bg-info",
        _ => "bg-secondary"
    };

    private static bool IsPreviewable(string? fileType) => IsPdfFile(fileType) || IsImageFile(fileType);
    private static bool IsPdfFile(string? fileType) => string.Equals(fileType, "PDF", StringComparison.OrdinalIgnoreCase);
    private static bool IsImageFile(string? fileType) => fileType?.ToUpperInvariant() is "JPG" or "JPEG" or "PNG" or "GIF" or "WEBP" or "BMP" or "IMAGE";

    private void GoToList() => Nav.NavigateTo("/documents");
    private void GoToNew() => Nav.NavigateTo("/documents/new");
    private void GoToDetail(int id) => Nav.NavigateTo($"/documents/{id}");
    private void EditDoc() { if (selectedDoc is not null) Nav.NavigateTo($"/documents/{selectedDoc.Id}/edit"); }
    private void GoToCustomer() { if (selectedDoc?.CustomerId is not null) Nav.NavigateTo($"/customers/{selectedDoc.CustomerId}"); }
    private void GoToSite() { if (selectedDoc?.SiteId is not null) Nav.NavigateTo($"/sites/{selectedDoc.SiteId}"); }
    private void GoToAsset() { if (selectedDoc?.AssetId is not null) Nav.NavigateTo($"/assets/{selectedDoc.AssetId}"); }
    private void GoToJob() { if (selectedDoc?.JobId is not null) Nav.NavigateTo($"/jobs/{selectedDoc.JobId}"); }
    private void GoToEmployee() { if (selectedDoc?.EmployeeId is not null) Nav.NavigateTo($"/employees/{selectedDoc.EmployeeId}"); }
    private async Task HandleSearchKey(KeyboardEventArgs e) { if (e.Key == "Enter") await LoadDocuments(); }
}

